{% load main_tags %}
<script>
function clear_value{{ ctl.id }}(){
	var xhr = new XMLHttpRequest();
	xhr.open('GET', "http://{{ host }}/clear_userfieldparam/{{ user.id }}/{{ ctl.id }}/", false);
	xhr.send();
}

function set_value{{ ctl.id }}(value){
	var val = {value: value};
	$.ajax({
	    url:  "http://{{ host }}/set_userfieldparam/{{ user.id }}/{{ ctl.id }}/1/",
	    type: 'POST',
	    contentType: 'application/json; charset=utf-8',
	    data: JSON.stringify(val),
	    dataType: 'text',
	    success: function(result) {}
	});
}

function sendRequestDiargam{{ ctl.id }}(url) {
	$.ajax({
		url: url,
		success: function(data){
			$('#chart_container{{ ctl.id }}').highcharts({
				chart: {
					type: {% if ctl.param3 == 'diagram' %}'column'{% else %}{% if ctl.param3 == 'pie' %}'pie'{% else %}'line'{% endif %}{% endif %}
				},
				title: {
					text: ''
				},
				xAxis: {
					title: {
						text: '{{ ctl.param2|chart_x|safe }}'
					}
				},
				yAxis: {
					title: {
						text: '{{ ctl.param2|chart_y|safe }}'
					}
				},
				series: [{
					name: '{{ ctl.param2|chart_name|safe }}',
					data: data.Data
					},]
				});
				clear_value{{ ctl.id }}();
				set_value{{ ctl.id }}(data.Data.join(';'));
		},
		error: function(data){
			clear_value{{ ctl.id }}();
		},
		type: "GET",
		dataType: "json"
		});
}
</script>

<h3>{{ ctl.name|safe }}</h3>
<div id="chart_container{{ ctl.id }}" class="chart_container"></div>
<div class="div-construct-submit" style="margin-top: 20px;" onClick="sendRequestDiargam{{ ctl.id }}('{{ url }}&n={{ ctl.param1 }}');">Построить график</div>
